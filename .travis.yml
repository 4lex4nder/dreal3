language: cpp

env:
  global:
    # DREALREPO
    - secure: "Q0UZnALjy+EboS3XBUaH+liMrCITbDXybFGmriDOLPKGPmAeNxN9lCXLyl4T9ZOPNpjTEAeSBSDkmxKuBTbFGFEAOhamsTZQnLkXzFtIJNXxF13c/ubMPwkY0PgLrayvqJdmNcLqM1goz7OuLrMg/rb0JM7JVOScdn++7OfJae8="
    # GH_TOKEN
    - secure: "dgm4Dvk64PhJN0dWMdXoQVP0ObANaarW3IvGqxvJ4jADTRSZzFqeA4hYM3cLAb2Rkmx2ftKdQqFbRUfWysT26Zd3CykbdgqmNgYN+kHntkeUmGvoB8SidCwzwo1VsU8f53DG//bYw3ZpBJZY/ljfiehdsi4BTxrIcX7pW1DQZ0Q="

  matrix:
    - TRIGGER_OSX=TRUE
      CMAKE_CXX_COMPILER=g++-4.8 CMAKE_C_COMPILER=gcc-4.8
      BUILD_TYPE=RELEASE
    - CMAKE_CXX_COMPILER=g++-4.8 CMAKE_C_COMPILER=gcc-4.8
      BUILD_TYPE=DEBUG

install:
  # TRIGGER OSX Build
  - if [[ $DREALREPO == BLESSED && $TRIGGER_OSX == TRUE ]]; then
      MSG=`git log --pretty=oneline --abbrev-commit -n 1 | cut -d ' ' -f 2-`;
      cp .travis.yml /tmp/.travis.temp.yml;
      cp .travis.osx.yml .travis.yml;
      git config --global user.email "notifications@travis-ci.org";
      git config --global user.name "Travis CI";
      git add .travis.yml;
      git commit -m "$MSG";
      git push -q https://soonhokong:${GH_TOKEN}@github.com/soonhokong/dReal-osx.git +HEAD:master;
      mv /tmp/.travis.temp.yml .travis.yml;
      git reset --hard HEAD~;
    fi
  # Add ppas
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
  - sudo add-apt-repository --yes ppa:boost-latest/ppa
  - sudo add-apt-repository --yes ppa:dns/gnu
  - sudo add-apt-repository --yes ppa:avsm/ppa
  - sudo apt-get -qq update
  - sudo apt-get -qq install libstdc++-4.8-dev
  - sudo apt-get -qq install git g++-4.8
  # Install Bison, Flex, CMAKE
  - sudo apt-get -qq install bison flex wget cmake
  # Install Boost
  - sudo apt-get -qq install libboost1.54-all-dev
  # Install capdDynSys-3.0
  - sudo apt-get -qq install automake autoconf libtool
  - wget http://krzesanica.ii.uj.edu.pl/capd/capdDynSys.zip
  - unzip -qq capdDynSys.zip
  - cd capd_dynsys
  - autoreconf --install
  - ./configure --without-gui CXX=g++-4.8 CC=gcc-4.8
  - make
  - sudo make install
  - cd ..
  # Ocaml
  - sudo apt-get -qq install ocaml opam
  - yes | opam init
  - eval `opam config env`
  - opam update
  - yes | opam install ocamlfind batteries

script:
  # compile dReal
  - mkdir build
  - cd build
  - cmake -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER} -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER} -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} ../src
  - make
  - cd ..
  # compile tools
  - make -C tools
  # compile proof checker
  - make -C tools/proofcheck/checker

notifications:
  email:
    recipients:
    - soonho.kong@gmail.com
    on_success: always
    on_failure: always
